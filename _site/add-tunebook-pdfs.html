<h1 id="updating-tunebook-pdfs">Updating Tunebook PDFs</h1>

<p>This script is run once a week and the resulting PDFs are uploaded to the master repository using <strong>git push</strong>. 
The next time <em>gh-pages</em> is updated using <strong>git pull</strong> these PDFs will be included. This means that the Tunebooks 
will be one revision behind the tunes shown on the site.</p>

<p>```
#!/bin/sh</p>

<p>SOURCEDIR=’/Users/asjl/gitrepos/slow-session’
SITEDIR=’/Users/asjl/gitrepos/slow-session/_site/abc-collections’</p>

<p>ARCHIVE=’archive.abc’
CURRENT=’current.abc’
TWOBAR=’2bar.abc’</p>

<p>#
# Build the ABC source files in ${SITEDIR}
#
cd ${SOURCEDIR}
/usr/local/bin/jekyll build
if [ $? -ne 0 ]
then
    exit
fi</p>

<p>#
# Build the PDF files in ${SOURCEDIR}
#
cd ${SOURCEDIR}/abc-collections</p>

<p>/Users/asjl/bin/abc2pdf ${SITEDIR}/${ARCHIVE}
/Users/asjl/bin/abc2pdf ${SITEDIR}/${CURRENT}
/Users/asjl/bin/abc2pdf ${SITEDIR}/${TWOBAR}</p>

<p>cd ${SOURCEDIR}
#
# Push the new PDFs to the main site
# They’ll get loaded next time there’s an upgrade
#
/usr/local/bin/git pull 
/usr/local/bin/git add .
/usr/local/bin/git commit -m “Updating Tunebook PDFs”
/usr/local/bin/git push
```</p>

<p>The script abc2pdf looks like:</p>

<p><code class="highlighter-rouge">
<span class="c">#!/bin/sh</span>
<span class="c"># Convert a text file with abc musical notation (abcnotation.com)</span>
<span class="c"># to a PDF, using abc2ps.</span>
<span class="nv">TMPPS</span><span class="o">=</span><span class="k">$(</span>mktemp /tmp/temp.XXXXXXX<span class="k">)</span>.ps
<span class="nv">PDF</span><span class="o">=</span><span class="k">$(</span>basename <span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="p">%.abc</span><span class="k">}</span><span class="s2">.pdf"</span><span class="k">)</span>
/Users/asjl/bin/abcm2ps <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> -q -O <span class="nv">$TMPPS</span>
/usr/local/bin/ps2pdf <span class="nv">$TMPPS</span> <span class="nv">$PDF</span>
<span class="c">#echo "Created $PDF"</span>
rm <span class="nv">$TMPPS</span>
</code></p>
